<!DOCTYPE html>
<html>
    <head>
        <script src='https://d3js.org/d3.v5.min.js'>
        </script>
    </head>
    <body onload='init()'>
        <h1>GDP</h1>
        <!-- create chart division -->
        <div id="chart"></div>

        <script>
            async function init() {
                // read data from csv file
                // const data = await d3.csv('data/GSPC.csv',
                //                 function(d){
                //                     return { date : d3.timeParse("%Y-%m-%d")(d.Date), 
                //                              adjClosePrice : d.adjClose }
                                // });
                console.log("loading data...");
                const data = await d3.csv('https://datahub.io/core/s-and-p-500/r/data.csv', 
                                        function(data) { return {date : d3.timeParse("%Y-%m-%d")(data.Date), price : data["Real Price"]};});
        
                d3.select("#chart")
                  .append("p")
                  .text("Hello")
                // set dimensions of the chart area
                var margin = {top: 10, right: 40, bottom: 30, left: 100};
                var width = 1050 - margin.left - margin.right;
                var height = 1000 - margin.top - margin.bottom;

                var mySvg = d3.select("#chart")
                            .append("svg")
                            .attr("width", width + margin.left + margin.right)
                            .attr("height", height + margin.top + margin.bottom)
                            .append("g")
                                .attr("transform", "translate("+margin.left+","+margin.top + ")");

                // // X scale and Axis
                // var x = d3.scaleLinear()
                //     .domain([0, 100])         // This is the min and the max of the data: 0 to 100 if percentages
                //     .range([0, width]);       // This is the corresponding value I want in Pixel
                // sVg.append('g')
                //     .attr("transform", "translate(0," + height + ")")
                //     .call(d3.axisBottom(x));

                // // X scale and Axis
                // var y = d3.scaleLinear()
                //     .domain([0, 100])         // This is the min and the max of the data: 0 to 100 if percentages
                //     .range([height, 0]);       // This is the corresponding value I want in Pixel
                // sVg.append('g')
                //     .call(d3.axisLeft(y));



                // Add X axis --> it is a date format
                var x = d3.scaleTime()
                .domain(d3.extent(data, function(d) { return d.date; }))
                .range([ 0, width ]);
                mySvg.append("g")
                .attr("transform", "translate(0," + height + ")")
                .call(d3.axisBottom(x));

                // Add Y axis
                var y = d3.scaleLinear()
                .domain([0, d3.max(data, function(d) { return +d.price; })])
                .range([ height, 0 ]);
                mySvg.append("g")
                .call(d3.axisLeft(y));

                // Add the line
                mySvg.append("path")
                .datum(data)
                .attr("fill", "none")
                .attr("stroke", "steelblue")
                .attr("stroke-width", 1.5)
                .attr("d", d3.line()
                    .x(function(d) { return x(d.date) })
                    .y(function(d) { return y(d.price) })
                    )


            }
        </script>


        <script>
            function clear() {
                d3.select('#chart').html="";
            }
        </script>
    </body>
</html>
